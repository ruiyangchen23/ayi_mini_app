{"version":3,"file":"pages/messages/index.js","mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAaA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACgCA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AApBA;AAAA;AAAA;AAsBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AApBA;AAAA;AAAA;AAsBA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;AAzLA;AAAA;;AASA;AAAA;;AACA;AAAA;;AACA;AAAA;;AAEA;AAAA;;AACA;AAAA;;;AAGA;AAAA;;AACA;AAAA;;AACA;AAAA;;AAIA;AAAA;;AAGA;AAAA;;AAYA;AAAA;;AACA;AAAA;;AACA;AAAA;;AAEA;AAAA;;AAGA;AAAA;;;;;AA7CA;AACA;;AAAA;AAAA;;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAMA;AAAA;AAEA;AAMA;AACA;AAAA;;;AADA;AAIA;AAAA;;;AADA;;;;AAKA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AAAA;;;AADA;AAIA;AAAA;;;AADA;;;;;;;;;;;;;;;;;;;;;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACPA","sources":["webpack://aydwj/./src/pages/messages/index.vue?4546","webpack://aydwj/._src_pages_messages_index.vue","webpack://aydwj/./src/pages/messages/index.vue?6893","webpack://aydwj/./src/pages/messages/index.vue?b134","webpack://aydwj/./src/pages/messages/index.vue?999a"],"sourcesContent":["import { render } from \"./index.vue?vue&type=template&id=6fcfab5a\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=6fcfab5a&lang=scss\"\n\nimport exportComponent from \"C:\\\\Users\\\\aligu\\\\Downloads\\\\miniapp\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__file',\"src/pages/messages/index.vue\"]])\n/* hot reload */\nif (module.hot) {\n  __exports__.__hmrId = \"6fcfab5a\"\n  const api = __VUE_HMR_RUNTIME__\n  module.hot.accept()\n  if (!api.createRecord('6fcfab5a', __exports__)) {\n    api.reload('6fcfab5a', __exports__)\n  }\n  \n  module.hot.accept(\"./index.vue?vue&type=template&id=6fcfab5a\", () => {\n    api.rerender('6fcfab5a', render)\n  })\n\n}\n\n\nexport default __exports__","<template>\r\n  <view class=\"messages\">\r\n    <nut-tabs v-model=\"tabvalue\">\r\n      <nut-tabpane title=\"评论消息\">\r\n        <scroll-view\r\n          class=\"list comment\"\r\n          :scroll-y=\"true\"\r\n          @scrolltolower=\"commentLower\"\r\n        >\r\n          <view v-for=\"(it, idx) in commentList\" :key=\"idx\" class=\"it bgc-w\">\r\n            <view class=\"top\">\r\n              <view class=\"title\">{{ it.title }}</view>\r\n              <view class=\"time\">{{ it.triggerTimeStr }}</view>\r\n            </view>\r\n            <view class=\"bottom\">\r\n              <view class=\"left\">\r\n                <img class=\"avatar\" :src=\"it.avatar\" />\r\n              </view>\r\n              <view class=\"center\">\r\n                <view class=\"name\">{{ it.nickname }}</view>\r\n                <view class=\"content\">{{ it.content }}</view>\r\n              </view>\r\n            </view>\r\n          </view>\r\n          <view v-show=\"commentMoreLoading\" class=\"footer\">\r\n            <nut-divider>加载中 ...</nut-divider>\r\n          </view>\r\n          <view v-show=\"!commentHasMore\" class=\"footer\">\r\n            <nut-divider>到底啦</nut-divider>\r\n          </view>\r\n        </scroll-view>\r\n      </nut-tabpane>\r\n      <nut-tabpane title=\"系统消息\">\r\n        <scroll-view\r\n          class=\"list sys\"\r\n          :scroll-y=\"true\"\r\n          @scrolltolower=\"sysLower\"\r\n        >\r\n          <view v-for=\"(it, idx) in sysList\" :key=\"idx\" class=\"it bgc-w\">\r\n            <view class=\"title\">{{ it.title }}</view>\r\n            <view class=\"time valc-h\">{{ it.time }}</view>\r\n            <view class=\"content\">{{ it.content }}</view>\r\n          </view>\r\n          <view v-show=\"sysMoreLoading\" class=\"footer\">\r\n            <nut-divider>加载中 ...</nut-divider>\r\n          </view>\r\n          <view v-show=\"!sysHasMore\" class=\"footer\">\r\n            <nut-divider>到底啦</nut-divider>\r\n          </view>\r\n        </scroll-view>\r\n      </nut-tabpane>\r\n    </nut-tabs>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { reactive, toRefs, onMounted } from \"vue\";\r\nimport API from \"../../utils/api\";\r\nimport Taro from \"@tarojs/taro\";\r\n\r\nexport default {\r\n  name: \"Messages\",\r\n  components: {},\r\n  setup() {\r\n    const state = reactive({\r\n      tabvalue: 0,\r\n      myCommentMsgParam: {},\r\n      myCommentMsgRes: {},\r\n      mySysMsgParam: {},\r\n      mySysMsgRes: {},\r\n      commentMoreLoading: false,\r\n      commentHasMore: true,\r\n      sysMoreLoading: false,\r\n      sysHasMore: true,\r\n      commentList: [],\r\n      sysList: [],\r\n    });\r\n\r\n    onMounted(async () => {\r\n      state.myCommentMsgParam.pageNum = 1;\r\n      state.myCommentMsgParam.pageSize = 20;\r\n      state.commentMoreLoading = true;\r\n      API.requestAfterHandle(\r\n        await API.myCommentMsg(state.myCommentMsgParam),\r\n        (data) => {\r\n          if (data.records.length > 0) {\r\n            for (const it of data.records) {\r\n              it.triggerTimeStr = API.timeTxt(it.triggerTime);\r\n            }\r\n          }\r\n          state.myCommentMsgRes = data;\r\n          state.commentList.splice(0, state.commentList.length);\r\n          state.commentList.push(...state.myCommentMsgRes.records);\r\n          handleAfterCommentMsg();\r\n        }\r\n      );\r\n      state.commentMoreLoading = false;\r\n      state.mySysMsgParam.pageNum = 1;\r\n      state.mySysMsgParam.pageSize = 20;\r\n      state.sysMoreLoading = true;\r\n      API.requestAfterHandle(\r\n        await API.mySysMsg(state.mySysMsgParam),\r\n        (data) => {\r\n          if (data.records.length > 0) {\r\n            for (const it of data.records) {\r\n              it.triggerTimeStr = API.timeTxt(it.triggerTime);\r\n            }\r\n          }\r\n          state.mySysMsgRes = data;\r\n          state.sysList.splice(0, state.sysList.length);\r\n          state.sysList.push(...state.mySysMsgRes.records);\r\n          handleAfterSysMsg();\r\n        }\r\n      );\r\n      state.sysMoreLoading = false;\r\n\r\n      const readAll1 = API.requestAfterHandle(await API.readAll(\"1,2,3,4,5\"));\r\n      if (readAll1.msg == \"ok\") {\r\n        API.requestAfterHandle(await API.countUnread(), (data) => {\r\n          Taro.setStorageSync(\"unreadCount\", data || []);\r\n        });\r\n      }\r\n    });\r\n\r\n    const commentLower = async () => {\r\n      if (!state.commentHasMore || state.commentMoreLoading) {\r\n        return;\r\n      }\r\n      state.commentMoreLoading = true;\r\n      state.myCommentMsgParam.pageNum++;\r\n      API.requestAfterHandle(\r\n        await API.myCommentMsg(state.myCommentMsgParam),\r\n        (data) => {\r\n          if (data.records.length > 0) {\r\n            for (const it of data.records) {\r\n              it.triggerTimeStr = API.timeTxt(it.triggerTime);\r\n            }\r\n          }\r\n          state.myCommentMsgRes = data;\r\n          state.commentList.push(...state.myCommentMsgRes.records);\r\n          handleAfterCommentMsg();\r\n        }\r\n      );\r\n      state.commentMoreLoading = false;\r\n    };\r\n\r\n    const sysLower = async () => {\r\n      if (!state.sysHasMore || state.sysMoreLoading) {\r\n        return;\r\n      }\r\n      state.sysMoreLoading = true;\r\n      state.mySysMsgParam.pageNum++;\r\n      API.requestAfterHandle(\r\n        await API.myCommentMsg(state.mySysMsgParam),\r\n        (data) => {\r\n          if (data.records.length > 0) {\r\n            for (const it of data.records) {\r\n              it.triggerTimeStr = API.timeTxt(it.triggerTime);\r\n            }\r\n          }\r\n          state.mySysMsgRes = data;\r\n          state.sysList.push(...state.mySysMsgRes.records);\r\n          handleAfterSysMsg();\r\n        }\r\n      );\r\n      state.sysMoreLoading = false;\r\n    };\r\n\r\n    const handleAfterCommentMsg = () => {\r\n      if (state.myCommentMsgRes.current >= state.myCommentMsgRes.pages) {\r\n        state.commentHasMore = false;\r\n      }\r\n    };\r\n\r\n    const handleAfterSysMsg = () => {\r\n      if (state.mySysMsgRes.current >= state.mySysMsgRes.pages) {\r\n        state.sysHasMore = false;\r\n      }\r\n    };\r\n\r\n    return {\r\n      ...toRefs(state),\r\n      commentLower,\r\n      sysLower,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.messages {\r\n  height: 100%;\r\n\r\n  .nut-tabs__content {\r\n    height: calc(100vh - 46px);\r\n\r\n    .nut-tabpane {\r\n      padding: 0;\r\n      height: 100%;\r\n\r\n      .list {\r\n        height: 100%;\r\n        background-color: #f7f8fa;\r\n\r\n        &.comment {\r\n          .it {\r\n            margin: 30rpx;\r\n            padding: 30rpx;\r\n            box-shadow: 0 0 2px 0px #bdbdbd;\r\n            border-radius: 20rpx;\r\n            box-sizing: border-box;\r\n\r\n            .top {\r\n              display: flex;\r\n              justify-content: space-between;\r\n\r\n              .title {\r\n                font-size: 30rpx;\r\n                font-weight: 600;\r\n              }\r\n\r\n              .time {\r\n                color: #8e8e8e;\r\n                font-size: 22rpx;\r\n              }\r\n            }\r\n\r\n            .bottom {\r\n              display: flex;\r\n              padding-top: 20rpx;\r\n\r\n              .left {\r\n                .avatar {\r\n                  width: 120rpx;\r\n                  height: 120rpx;\r\n                }\r\n              }\r\n\r\n              .center {\r\n                flex: 1;\r\n                margin: 0 20rpx;\r\n                width: 100%;\r\n\r\n                .name {\r\n                  font-size: 22rpx;\r\n                  font-weight: 600;\r\n                }\r\n\r\n                .content {\r\n                  color: #333;\r\n                  font-size: 22rpx;\r\n                  padding-top: 10rpx;\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        &.sys {\r\n          .it {\r\n            margin: 30rpx;\r\n            padding: 30rpx;\r\n            box-shadow: 0 0 2px 0px #bdbdbd;\r\n            border-radius: 10rpx;\r\n            box-sizing: border-box;\r\n\r\n            .title {\r\n              font-size: 32rpx;\r\n              font-weight: 600;\r\n            }\r\n\r\n            .time {\r\n              padding-top: 6rpx;\r\n              font-size: 24rpx;\r\n            }\r\n\r\n            .content {\r\n              padding-top: 20rpx;\r\n              font-size: 28rpx;\r\n            }\r\n          }\r\n        }\r\n\r\n        .footer {\r\n          padding: 0 100rpx 20rpx 100rpx;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/taro-loader/lib/raw.js!./index.vue\"\nvar config = {\"navigationBarTitleText\":\"我的消息\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/messages/index', {root:{cn:[]}}, config || {}))\n\n\n","export { default } from \"-!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-26.use[0]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./index.vue?vue&type=script&lang=js\"; export * from \"-!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-26.use[0]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./index.vue?vue&type=script&lang=js\"","export * from \"-!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-26.use[0]!../../../node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[2]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./index.vue?vue&type=template&id=6fcfab5a\""],"names":[],"sourceRoot":""}